function t(t){return/(?:calc|var|max|min|clamp)\(/.test(t)}const e={exact:t=>t.filter((t=>t.match(/^[^\*\!]+$/))),contain:t=>t.filter((t=>t.match(/^\*.+\*$/))).map((t=>t.substr(1,t.length-2))),endWith:t=>t.filter((t=>t.match(/^\*[^\*]+$/))).map((t=>t.substr(1))),startWith:t=>t.filter((t=>t.match(/^[^\*\!]+\*$/))).map((t=>t.substr(0,t.length-1))),notExact:t=>t.filter((t=>t.match(/^\![^\*].*$/))).map((t=>t.substr(1))),notContain:t=>t.filter((t=>t.match(/^\!\*.+\*$/))).map((t=>t.substr(2,t.length-3))),notEndWith:t=>t.filter((t=>t.match(/^\!\*[^\*]+$/))).map((t=>t.substr(2))),notStartWith:t=>t.filter((t=>t.match(/^\![^\*]+\*$/))).map((t=>t.substr(1,t.length-2)))},n=(t,e)=>-1===t.indexOf("font")?e.viewportUnit:e.fontViewportUnit,r=(t,e,n,r)=>function(o,a){if(!a)return o;const l=parseFloat(a);if(l<=t.minPixelValue&&!r)return o;const s=i(l/n*100,t.unitPrecision);return 0===s?"0":`${s}${e}`},i=(t,e)=>{const n=Math.pow(10,e+1),r=Math.floor(t*n);return 10*Math.round(r/10)/n},o=(t,e)=>"function"==typeof t?t(e):t,a={unitToConvert:"px",viewportUnit:"vw",viewportWidth:370,viewportHeight:568,fontViewportUnit:"vw",enable:!0,minPixelValue:1,unitPrecision:6,selectorBlackList:[],propList:["*"],replace:!0,mediaQuery:!1,mediaOptions:[]},l="px-to-viewport-ignore",s=i=>{const s=Object.assign({},a,i),c=(p=s.unitToConvert,new RegExp(`"[^"]+"|'[^']+'|url\\([^\\)]+\\)|(\\d*\\.?\\d+)${p}`,"g"));var p;const u=(t=>{const n=t.indexOf("*")>-1,r=n&&1===t.length,i={exact:e.exact(t),contain:e.contain(t),startWith:e.startWith(t),endWith:e.endWith(t),notExact:e.notExact(t),notContain:e.notContain(t),notStartWith:e.notStartWith(t),notEndWith:e.notEndWith(t)};return function(t){return!!r||(n||i.exact.indexOf(t)>-1||i.contain.some((e=>t.indexOf(e)>-1))||i.startWith.some((e=>0===t.indexOf(e)))||i.endWith.some((e=>t.indexOf(e)===t.length-e.length)))&&!(i.notExact.indexOf(t)>-1||i.notContain.some((e=>t.indexOf(e)>-1))||i.notStartWith.some((e=>0===t.indexOf(e)))||i.notEndWith.some((e=>t.indexOf(e)===t.length-e.length)))}})(s.propList);let f=[],d=[];return{postcssPlugin:"postcss-px-to-vw-device",Once(e,{result:i}){e.walkRules((e=>{const a=e.source?.input.file||"";if(s.include&&a)if("[object RegExp]"===Object.prototype.toString.call(s.include)){if(!s.include.test(a))return}else if(s.include instanceof Array){let t=!1;for(let e=0;e<s.include.length;e++)if(s.include[e].test(a)){t=!0;break}if(!t)return}if(s.exclude&&a)if("[object RegExp]"===Object.prototype.toString.call(s.exclude)){if(s.exclude.test(a))return}else{if(!(s.exclude instanceof Array))throw new Error("options.exclude should be RegExp or Array.");for(let t=0;t<s.exclude.length;t++)if(s.exclude[t].test(a))return}if(!((t,e)=>{if("string"==typeof e)return t.some((t=>"string"==typeof t?-1!==e.indexOf(t):e.match(t)))})(s.selectorBlackList,e.selector)){if(s.mediaOptions?.length&&!e.parent?.params){const i=s.mediaOptions.filter((t=>"boolean"==typeof t.enable?t.enable:s.enable??!1));for(let l=0;l<i.length;l++){const{viewportWidth:p=s.viewportWidth,unitToConvert:f=s.unitToConvert,viewportUnit:m=s.viewportUnit,fontViewportUnit:h=s.fontViewportUnit,mediaParam:x}=i[l],v=e.clone().removeAll();e.walkDecls((e=>{if(-1===e.value.indexOf(f))return;if(!u(e.prop))return;const i=o(p,a);if(!i)return;const l=n(e.prop,{...s,viewportUnit:m,fontViewportUnit:h});v.append(e.clone({value:e.value.replace(c,r(s,l,i,t(e.value)))}))})),v.nodes.length>0&&(d[l]||(d[l]={mediaParam:x,rules:[]}),d[l].rules.push(v))}}var p,f;if(p=e.parent?.params,f=s.mediaQuery,!p||p&&f)e.walkDecls(((p,f)=>{if(!s.enable)return;if(-1===p.value.indexOf(s.unitToConvert))return;if(!u(p.prop))return;const d=p.prev();if(d&&"comment"===d.type&&"px-to-viewport-ignore-next"===d.text)return void d.remove();const m=p.next();if(m&&"comment"===m.type&&m.text===l){if(!m?.raws?.before||!/\n/.test(m.raws.before))return void m.remove();i.warn("Unexpected comment /* "+l+" */ must be after declaration at same line.",{node:m})}let h,x;const{params:v}=e.parent;if(v&&-1!==v.indexOf("landscape"))return;{h=n(p.prop,s);const t=o(s.viewportWidth,a);if(!t)return;x=t}const w=p.value.replace(c,r(s,h,x,t(p.value)));((t,e,n)=>t?.some((t=>t.prop===e&&t.value===n)))(p.parent,p.prop,w)||(s.replace?p.value=w:p.parent?.insertAfter(f,p.clone({value:w})))}))}}))},OnceExit(t,{AtRule:e}){if(f.length>0){const n=new e({params:"(orientation: landscape)",name:"media"});f.forEach((function(t){n.append(t)})),t.append(n),f=[]}if(d.length>0){for(let n=0;n<d.length;n++){let r=d[n],{mediaParam:i,rules:o}=r;const a=new e({params:i,name:"media"});o.forEach((function(t){a.append(t)})),t.append(a)}d=[]}}}};s.postcss=!0,module.exports=s;export{s as default};
//# sourceMappingURL=index.mjs.map
